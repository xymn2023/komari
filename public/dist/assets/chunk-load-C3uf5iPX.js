import{R as l,j as e,a as M}from"./entry-index-Cq13IMyc.js";import{N as L,T as G}from"./chunk-NodeSelectorDialog-BsrwgFJM.js";import{T as K,a as Q,c as b,d as W,b as X,e as y}from"./chunk-table-BS5X1aPI.js";import{N as Y,u as V,P as Z}from"./chunk-NodeDetailsContext-Bc0mLyEG.js";import{t as v}from"./chunk-index-CSMgxAiP.js";import{u as w}from"./chunk-useTranslation-DT6f2-nl.js";import{E as ee}from"./chunk-ellipsis-CC8CAYPp.js";import{p as T}from"./chunk-flex-D_qeScnl.js";import{s as E,n as D,p as k,g as P,D as _}from"./chunk-dialog-ChtOFG_l.js";import{o as N}from"./chunk-button-BTrNb_zO.js";import{u as g}from"./chunk-text-field-BPsisRj1.js";import{C as q,u as $,g as z,v as x}from"./chunk-select-SplvZF8F.js";import{o as O}from"./chunk-icon-button-8RHoNX6f.js";import"./chunk-react-vendor-Csw2ODfV.js";import"./chunk-createLucideIcon-SgBSd_zz.js";import"./chunk-search-CaXYtT1h.js";import"./chunk-utils-bRKmu4jq.js";import"./chunk-require-react-element-DaU34sMa.js";import"./chunk-internal-BM6wX41l.js";import"./chunk-icons-Czmt910x.js";import"./chunk-index-CMdh1AKP.js";import"./chunk-index-FhuETDEf.js";const J=l.createContext(void 0),ne=({children:n})=>{const[r,d]=l.useState(null),[p,m]=l.useState(!1),[o,a]=l.useState(null),u=()=>{a(null),fetch("/api/admin/notification/load").then(c=>{if(!c.ok)throw new Error("Failed to fetch notification tasks");return c.json()}).then(c=>{c&&Array.isArray(c.data)?d(c.data):d([])}).catch(c=>{a(c.message||"An error occurred while fetching load alerts")}).finally(()=>{m(!1)})};return l.useEffect(()=>{m(!0),u(),m(!1)},[]),e.jsx(J.Provider,{value:{loadAlerts:r,isLoading:p,error:o,refresh:u},children:n})},R=()=>{const n=l.useContext(J);if(!n)throw new Error("useLoadAlert must be used within a LoadAlertProvider");return n},Le=()=>e.jsx(ne,{children:e.jsx(Y,{children:e.jsx(se,{})})}),se=()=>{const{loadAlerts:n,isLoading:r,error:d}=R(),{isLoading:p,error:m}=V(),{t:o}=w();return r||p?e.jsx(M,{}):d||m?e.jsx("div",{children:d||m}):e.jsxs(T,{direction:"column",gap:"4",className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-2xl font-bold",children:o("notification.load.title")}),e.jsx(re,{})]}),e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsxs(K,{children:[e.jsxs(Q,{children:[e.jsx(b,{children:o("common.name")}),e.jsx(b,{children:o("common.server")}),e.jsx(b,{children:o("loadAlert.metric")}),e.jsx(b,{children:o("common.threshold")}),e.jsx(b,{children:o("loadAlert.ratio")}),e.jsx(b,{children:o("ping.interval")}),e.jsx(b,{children:o("common.action")})]}),e.jsx(W,{children:n==null?void 0:n.slice().sort((a,u)=>(u.id??0)-(a.id??0)).map(a=>e.jsx(te,{alert:a},a.id))})]})})]})},te=({alert:n})=>{var I;const{t:r}=w(),{refresh:d}=R(),{nodeDetail:p}=V(),[m,o]=l.useState(!1),[a,u]=l.useState(!1),[c,S]=l.useState(!1),[A,j]=l.useState(!1),[h,i]=l.useState({name:n.name||"",metric:n.metric||"cpu",threshold:n.threshold||80,ratio:n.ratio||.8,clients:n.clients||[],interval:n.interval||15}),f=s=>{u(!0),fetch("/api/admin/notification/load/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notifications:[{id:n.id,name:s.name,metric:s.metric,threshold:s.threshold,ratio:s.ratio,clients:s.clients,interval:s.interval}]})}).then(t=>t.ok?t.json():t.json().then(C=>{throw new Error((C==null?void 0:C.message)||r("common.error"))})).then(()=>{o(!1),v.success(r("common.updated_successfully")),d()}).catch(t=>{v.error(t.message)}).finally(()=>u(!1))},U=s=>{s.preventDefault(),f(h)},B=()=>{j(!0),fetch("/api/admin/notification/load/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[n.id]})}).then(s=>s.ok?s.json():s.json().then(t=>{throw new Error((t==null?void 0:t.message)||r("common.error"))})).then(()=>{S(!1),v.success(r("common.deleted_successfully")),d()}).catch(s=>{v.error(s.message)}).finally(()=>j(!1))};return e.jsxs(X,{children:[e.jsx(y,{children:n.name}),e.jsx(y,{children:e.jsxs(T,{gap:"2",align:"center",children:[n.clients&&n.clients.length>0?(()=>{const t=n.clients.map(C=>{var F;return((F=p.find(H=>H.uuid===C))==null?void 0:F.name)||C}).join(", ");return t.length>40?t.slice(0,40)+"...":t})():r("common.none"),e.jsx(L,{value:h.clients??[],onChange:s=>{i(t=>({...t,clients:s})),f({...h,clients:s})},children:e.jsx(O,{variant:"ghost",children:e.jsx(ee,{size:"16"})})})]})}),e.jsx(y,{children:(I=n.metric)==null?void 0:I.toUpperCase()}),e.jsxs(y,{children:[n.threshold,"%"]}),e.jsx(y,{children:n.ratio}),e.jsxs(y,{children:[n.interval," ",r("time.minute")]}),e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsxs(E,{open:m,onOpenChange:o,children:[e.jsx(D,{children:e.jsx(O,{variant:"soft",children:e.jsx(Z,{size:"16"})})}),e.jsxs(k,{children:[e.jsx(P,{children:r("common.edit")}),e.jsxs("form",{onSubmit:U,className:"flex flex-col gap-2",children:[e.jsx("label",{children:r("common.name")}),e.jsx(g,{value:h.name,onChange:s=>i(t=>({...t,name:s.target.value})),required:!0}),e.jsx("label",{children:r("loadAlert.metric")}),e.jsxs(q,{value:h.metric,onValueChange:s=>i(t=>({...t,metric:s})),children:[e.jsx($,{}),e.jsxs(z,{children:[e.jsx(x,{value:"cpu",children:"CPU"}),e.jsx(x,{value:"ram",children:"RAM"}),e.jsx(x,{value:"disk",children:"Disk"}),e.jsx(x,{value:"net_in",children:"Net In"}),e.jsx(x,{value:"net_out",children:"Net Out"})]})]}),e.jsxs("label",{children:[r("common.threshold")," (%)"]}),e.jsx(g,{type:"number",value:h.threshold,onChange:s=>i(t=>({...t,threshold:Number(s.target.value)})),required:!0}),e.jsx("label",{children:r("loadAlert.ratio")}),e.jsx(g,{type:"number",step:"0.1",min:"0",max:"1",value:h.ratio,onChange:s=>i(t=>({...t,ratio:Number(s.target.value)})),required:!0}),e.jsx("label",{children:r("common.server")}),e.jsx(T,{children:e.jsx(L,{value:h.clients,onChange:s=>i(t=>({...t,clients:s}))})}),e.jsxs("label",{children:[r("ping.interval")," (",r("time.minute"),")"]}),e.jsx(g,{type:"number",value:h.interval,onChange:s=>i(t=>({...t,interval:Number(s.target.value)})),required:!0}),e.jsxs(T,{gap:"2",justify:"end",className:"mt-4",children:[e.jsx(_,{children:e.jsx(N,{variant:"soft",color:"gray",type:"button",onClick:()=>o(!1),children:r("common.cancel")})}),e.jsx(N,{variant:"solid",type:"submit",disabled:a,children:r("common.save")})]})]})]})]}),e.jsxs(E,{open:c,onOpenChange:S,children:[e.jsx(D,{children:e.jsx(O,{variant:"soft",color:"red",children:e.jsx(G,{size:"16"})})}),e.jsxs(k,{children:[e.jsx(P,{children:r("common.delete")}),e.jsxs(T,{gap:"2",justify:"end",className:"mt-4",children:[e.jsx(_,{children:e.jsx(N,{variant:"soft",color:"gray",type:"button",onClick:()=>S(!1),children:r("common.cancel")})}),e.jsx(N,{variant:"solid",color:"red",onClick:B,disabled:A,children:r("common.delete")})]})]})]})]})]},n.id)},re=()=>{const{t:n}=w(),[r,d]=l.useState(!1),[p,m]=l.useState([]),{refresh:o}=R(),[a,u]=l.useState("cpu"),[c,S]=l.useState(!1),A=j=>{j.preventDefault();const h={name:j.currentTarget.load_name.value,metric:a,threshold:parseFloat(j.currentTarget.threshold.value),ratio:parseFloat(j.currentTarget.ratio.value),clients:p,interval:parseInt(j.currentTarget.interval.value,10)};S(!0),fetch("/api/admin/notification/load/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}).then(i=>{i.ok?(d(!1),m([]),u("cpu"),v.success(n("common.success"))):i.json().then(f=>{v.error((f==null?void 0:f.message)||n("common.error"))}).catch(f=>{v.error(f.message)})}).catch(i=>{console.error("Error adding load alert:",i),v.error(i.message)}).finally(()=>{S(!1),o()})};return e.jsxs(E,{open:r,onOpenChange:d,children:[e.jsx(D,{children:e.jsx(N,{children:n("common.add")})}),e.jsxs(k,{children:[e.jsx(P,{children:n("common.add")}),e.jsx("form",{onSubmit:A,children:e.jsxs(T,{direction:"column",justify:"end",gap:"2",className:"font-bold",children:[e.jsx("label",{htmlFor:"load_name",children:n("common.name")}),e.jsx(g,{id:"load_name",name:"load_name"}),e.jsx("label",{htmlFor:"type",children:n("loadAlert.metric")}),e.jsxs(q,{value:a,onValueChange:j=>u(j),children:[e.jsx($,{id:"type",name:"type"}),e.jsxs(z,{children:[e.jsx(x,{value:"cpu",children:"CPU"}),e.jsx(x,{value:"ram",children:"RAM"}),e.jsx(x,{value:"disk",children:"Disk"}),e.jsx(x,{value:"net_in",children:"Net In"}),e.jsx(x,{value:"net_out",children:"Net Out"})]})]}),e.jsxs("label",{htmlFor:"threshold",children:[n("common.threshold")," (%)"]}),e.jsx(g,{id:"threshold",name:"threshold",type:"number",defaultValue:80,step:"0.1"}),e.jsx("label",{htmlFor:"ratio",children:n("loadAlert.ratio")}),e.jsx(g,{id:"ratio",name:"ratio",type:"number",step:"0.1",min:"0",max:"1",defaultValue:.8}),e.jsx("label",{htmlFor:"select",children:n("common.server")}),e.jsxs("div",{className:"flex items-center justify-start gap-2",children:[e.jsx(L,{value:p,onChange:m}),e.jsx("label",{className:"text-md font-normal",children:n("common.selected",{count:p.length})})]}),e.jsxs("label",{htmlFor:"interval",children:[n("ping.interval")," (",n("time.minute"),")"]}),e.jsx(g,{id:"interval",name:"interval",defaultValue:15,type:"number",placeholder:"15"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{children:e.jsx(N,{variant:"soft",children:n("common.close")})}),e.jsx(N,{disabled:c,type:"submit",children:n("common.add")})]})]})})]})]})};export{Le as default};
