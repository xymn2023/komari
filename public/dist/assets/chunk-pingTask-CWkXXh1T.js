import{R as l,j as e,a as M}from"./entry-index-Cq13IMyc.js";import{N as O,T as G}from"./chunk-NodeSelectorDialog-BsrwgFJM.js";import{T as K,a as Q,c as b,d as U,b as W,e as T}from"./chunk-table-BS5X1aPI.js";import{N as X,u as $,P as Y}from"./chunk-NodeDetailsContext-Bc0mLyEG.js";import{t as g}from"./chunk-index-CSMgxAiP.js";import{u as R}from"./chunk-useTranslation-DT6f2-nl.js";import{E as Z}from"./chunk-ellipsis-CC8CAYPp.js";import{p as S}from"./chunk-flex-D_qeScnl.js";import{s as D,n as _,p as w,g as L,D as I}from"./chunk-dialog-ChtOFG_l.js";import{o as f}from"./chunk-button-BTrNb_zO.js";import{u as C}from"./chunk-text-field-BPsisRj1.js";import{C as k,u as q,g as z,v as P}from"./chunk-select-SplvZF8F.js";import{o as E}from"./chunk-icon-button-8RHoNX6f.js";import"./chunk-react-vendor-Csw2ODfV.js";import"./chunk-createLucideIcon-SgBSd_zz.js";import"./chunk-search-CaXYtT1h.js";import"./chunk-utils-bRKmu4jq.js";import"./chunk-require-react-element-DaU34sMa.js";import"./chunk-internal-BM6wX41l.js";import"./chunk-icons-Czmt910x.js";import"./chunk-index-CMdh1AKP.js";import"./chunk-index-FhuETDEf.js";const F=l.createContext(void 0),ee=({children:n})=>{const[r,d]=l.useState(null),[j,m]=l.useState(!1),[i,a]=l.useState(null),h=()=>{a(null),fetch("/api/admin/ping").then(o=>{if(!o.ok)throw new Error("Failed to fetch ping tasks");return o.json()}).then(o=>{o&&Array.isArray(o.data)?d(o.data):d([])}).catch(o=>{a(o.message||"An error occurred while fetching ping tasks")}).finally(()=>{m(!1)})};return l.useEffect(()=>{m(!0),h(),m(!1)},[]),e.jsx(F.Provider,{value:{pingTasks:r,isLoading:j,error:i,refresh:h},children:n})},A=()=>{const n=l.useContext(F);if(!n)throw new Error("usePingTask must be used within a PingTaskProvider");return n},Ee=()=>e.jsx(ee,{children:e.jsx(X,{children:e.jsx(ne,{})})}),ne=()=>{const{pingTasks:n,isLoading:r,error:d}=A(),{isLoading:j,error:m}=$(),{t:i}=R();return r||j?e.jsx(M,{}):d||m?e.jsx("div",{children:d||m}):e.jsxs(S,{direction:"column",gap:"4",className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("label",{className:"text-2xl font-bold",children:i("ping.title")}),e.jsx(te,{})]}),e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsxs(K,{children:[e.jsxs(Q,{children:[e.jsx(b,{children:i("common.name")}),e.jsx(b,{children:i("common.server")}),e.jsx(b,{children:i("ping.target")}),e.jsx(b,{children:i("ping.type")}),e.jsx(b,{children:i("ping.interval")}),e.jsx(b,{children:i("common.action")})]}),e.jsx(U,{children:n==null?void 0:n.slice().sort((a,h)=>(h.id??0)-(a.id??0)).map(a=>e.jsx(se,{task:a},a.id))})]})})]})},se=({task:n})=>{const{t:r}=R(),{refresh:d}=A(),{nodeDetail:j}=$(),[m,i]=l.useState(!1),[a,h]=l.useState(!1),[o,v]=l.useState(!1),[N,u]=l.useState(!1),[p,c]=l.useState({name:n.name||"",type:n.type||"icmp",target:n.target||"",clients:n.clients||[],interval:n.interval||60}),x=s=>{h(!0),fetch("/api/admin/ping/edit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:[{id:n.id,name:s.name,type:s.type,target:s.target,clients:s.clients,interval:s.interval}]})}).then(t=>t.ok?t.json():t.json().then(y=>{throw new Error((y==null?void 0:y.message)||r("common.error"))})).then(()=>{i(!1),g.success(r("common.updated_successfully")),d()}).catch(t=>{g.error(t.message)}).finally(()=>h(!1))},J=s=>{s.preventDefault(),x(p)},V=()=>{u(!0),fetch("/api/admin/ping/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:[n.id]})}).then(s=>s.ok?s.json():s.json().then(t=>{throw new Error((t==null?void 0:t.message)||r("common.error"))})).then(()=>{v(!1),g.success(r("common.deleted_successfully")),d()}).catch(s=>{g.error(s.message)}).finally(()=>u(!1))};return e.jsxs(W,{children:[e.jsx(T,{children:n.name}),e.jsx(T,{children:e.jsxs(S,{gap:"2",align:"center",children:[n.clients&&n.clients.length>0?(()=>{const t=n.clients.map(y=>{var H;return((H=j.find(B=>B.uuid===y))==null?void 0:H.name)||y}).join(", ");return t.length>40?t.slice(0,40)+"...":t})():r("common.none"),e.jsx(O,{value:p.clients??[],onChange:s=>{c(t=>({...t,clients:s})),x({...p,clients:s})},children:e.jsx(E,{variant:"ghost",children:e.jsx(Z,{size:"16"})})})]})}),e.jsx(T,{children:n.target}),e.jsx(T,{children:n.type}),e.jsx(T,{children:n.interval}),e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsxs(D,{open:m,onOpenChange:i,children:[e.jsx(_,{children:e.jsx(E,{variant:"soft",children:e.jsx(Y,{size:"16"})})}),e.jsxs(w,{children:[e.jsx(L,{children:r("common.edit")}),e.jsxs("form",{onSubmit:J,className:"flex flex-col gap-2",children:[e.jsx("label",{children:r("common.name")}),e.jsx(C,{value:p.name,onChange:s=>c(t=>({...t,name:s.target.value})),required:!0}),e.jsx("label",{children:r("ping.type")}),e.jsxs(k,{value:p.type,onValueChange:s=>c(t=>({...t,type:s})),children:[e.jsx(q,{}),e.jsxs(z,{children:[e.jsx(P,{value:"icmp",children:"ICMP"}),e.jsx(P,{value:"tcp",children:"TCP"}),e.jsx(P,{value:"http",children:"HTTP"})]})]}),e.jsx("label",{children:r("ping.target")}),e.jsx(C,{value:p.target,onChange:s=>c(t=>({...t,target:s.target.value})),required:!0}),e.jsx("label",{children:r("common.server")}),e.jsx(S,{children:e.jsx(O,{value:p.clients,onChange:s=>c(t=>({...t,clients:s}))})}),e.jsxs("label",{children:[r("ping.interval")," (",r("time.second"),")"]}),e.jsx(C,{type:"number",value:p.interval,onChange:s=>c(t=>({...t,interval:Number(s.target.value)})),required:!0}),e.jsxs(S,{gap:"2",justify:"end",className:"mt-4",children:[e.jsx(I,{children:e.jsx(f,{variant:"soft",color:"gray",type:"button",onClick:()=>i(!1),children:r("common.cancel")})}),e.jsx(f,{variant:"solid",type:"submit",disabled:a,children:r("common.save")})]})]})]})]}),e.jsxs(D,{open:o,onOpenChange:v,children:[e.jsx(_,{children:e.jsx(E,{variant:"soft",color:"red",children:e.jsx(G,{size:"16"})})}),e.jsxs(w,{children:[e.jsx(L,{children:r("common.delete")}),e.jsxs(S,{gap:"2",justify:"end",className:"mt-4",children:[e.jsx(I,{children:e.jsx(f,{variant:"soft",color:"gray",type:"button",onClick:()=>v(!1),children:r("common.cancel")})}),e.jsx(f,{variant:"solid",color:"red",onClick:V,disabled:N,children:r("common.delete")})]})]})]})]})]},n.id)},te=()=>{const{t:n}=R(),[r,d]=l.useState(!1),[j,m]=l.useState([]),{refresh:i}=A(),[a,h]=l.useState("icmp"),[o,v]=l.useState(!1),N=u=>{u.preventDefault();const p={name:u.currentTarget.ping_name.value,type:a,target:u.currentTarget.ping_target.value,clients:j,interval:parseInt(u.currentTarget.interval.value,10)};v(!0),fetch("/api/admin/ping/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).then(c=>{c.ok?(d(!1),m([]),h("icmp"),g.success(n("common.success"))):c.json().then(x=>{g.error((x==null?void 0:x.message)||n("common.error"))}).catch(x=>{g.error(x.message)})}).catch(c=>{console.error("Error adding ping task:",c),g.error(c.message)}).finally(()=>{v(!1),i()})};return e.jsxs(D,{open:r,onOpenChange:d,children:[e.jsx(_,{children:e.jsx(f,{children:n("common.add")})}),e.jsxs(w,{children:[e.jsx(L,{children:n("common.add")}),e.jsx("form",{onSubmit:N,children:e.jsxs(S,{direction:"column",justify:"end",gap:"2",className:"font-bold",children:[e.jsx("label",{htmlFor:"ping_name",children:n("common.name")}),e.jsx(C,{id:"ping_name",name:"ping_name"}),e.jsx("label",{htmlFor:"type",children:n("ping.type")}),e.jsxs(k,{value:a,onValueChange:u=>h(u),children:[e.jsx(q,{id:"type",name:"type"}),e.jsxs(z,{children:[e.jsx(P,{value:"icmp",children:"ICMP"}),e.jsx(P,{value:"tcp",children:"TCP"}),e.jsx(P,{value:"http",children:"HTTP"})]})]}),e.jsx("label",{htmlFor:"ping_target",children:n("ping.target")}),e.jsx(C,{id:"ping_target",name:"ping_target",placeholder:"1.1.1.1 | 1.1.1.1:80 | https://1.1.1.1"}),e.jsx("label",{htmlFor:"ping_server",children:n("common.server")}),e.jsxs("div",{className:"flex items-center justify-start gap-2",children:[e.jsx(O,{value:j,onChange:m}),e.jsx("label",{className:"text-md font-normal",children:n("common.selected",{count:j.length})})]}),e.jsxs("label",{htmlFor:"interval",children:[n("ping.interval")," (",n("time.second"),")"]}),e.jsx(C,{id:"interval",name:"interval",defaultValue:60,type:"number",placeholder:"60"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(I,{children:e.jsx(f,{variant:"soft",children:n("common.close")})}),e.jsx(f,{disabled:o,type:"submit",children:n("common.add")})]})]})})]})]})};export{Ee as default};
