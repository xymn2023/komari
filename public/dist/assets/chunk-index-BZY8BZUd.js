import{R as S,r as L,p as Ce,o as Fe,j as e,a as $e}from"./entry-index-Cq13IMyc.js";import{u as Te,a as Re}from"./chunk-LiveDataContext-BPSUpA8k.js";import{b as ne,L as me,m as he,i as le,C as ge,A as ze,c as se,d as De,e as We,h as Pe,j as He,k as Ge,u as Xe,l as ve,G as Ye,n as Ne,o as Se,D as Ue,p as qe,X as U,Y as q,q as Je,r as je,s as Z,t as ee,v as te,w as ae,a as K,x as pe,y as ce,z as Qe,T as Ze,B as et,E as tt,F as at,H as rt}from"./chunk-Node-BXTfQ3ZC.js";import{u as Ae,p as Ee}from"./chunk-useTranslation-DT6f2-nl.js";import{a as Ke}from"./chunk-utils-bRKmu4jq.js";import{p as re}from"./chunk-flex-D_qeScnl.js";import{p as ke,l as xe}from"./chunk-segmented-control-C3cF3Z3E.js";import{o as J}from"./chunk-card--UUq0CNs.js";import{i as it}from"./chunk-switch-CttJqP-B.js";import{D as nt}from"./chunk-DetailsGrid-B05C65T9.js";import"./chunk-react-vendor-Csw2ODfV.js";import"./chunk-proxy-BKiT5fFT.js";import"./chunk-box-BWWdO3eg.js";import"./chunk-use-mobile-BDllwLRx.js";import"./chunk-createLucideIcon-SgBSd_zz.js";import"./chunk-dialog-ChtOFG_l.js";import"./chunk-require-react-element-DaU34sMa.js";import"./chunk-button-BTrNb_zO.js";import"./chunk-badge-C4fUOBFU.js";import"./chunk-throttle-CmHaeH0s.js";import"./chunk-icon-button-8RHoNX6f.js";import"./chunk-internal-BM6wX41l.js";import"./chunk-index-SkULk3VY.js";import"./chunk-index-FhuETDEf.js";import"./chunk-index-CMdh1AKP.js";var st=["layout","type","stroke","connectNulls","isRange","ref"],ot=["key"],Ve;function ue(a){"@babel/helpers - typeof";return ue=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ue(a)}function Me(a,t){if(a==null)return{};var i=lt(a,t),r,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);for(n=0;n<o.length;n++)r=o[n],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(a,r)&&(i[r]=a[r])}return i}function lt(a,t){if(a==null)return{};var i={};for(var r in a)if(Object.prototype.hasOwnProperty.call(a,r)){if(t.indexOf(r)>=0)continue;i[r]=a[r]}return i}function ie(){return ie=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(a[r]=i[r])}return a},ie.apply(this,arguments)}function Oe(a,t){var i=Object.keys(a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(a);t&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),i.push.apply(i,r)}return i}function Y(a){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Oe(Object(i),!0).forEach(function(r){G(a,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(i)):Oe(Object(i)).forEach(function(r){Object.defineProperty(a,r,Object.getOwnPropertyDescriptor(i,r))})}return a}function ct(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")}function _e(a,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(a,Ie(r.key),r)}}function ut(a,t,i){return t&&_e(a.prototype,t),i&&_e(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a}function dt(a,t,i){return t=ye(t),mt(a,Be()?Reflect.construct(t,i||[],ye(a).constructor):t.apply(a,i))}function mt(a,t){if(t&&(ue(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ft(a)}function ft(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function Be(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Be=function(){return!!a})()}function ye(a){return ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},ye(a)}function ht(a,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(t&&t.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),Object.defineProperty(a,"prototype",{writable:!1}),t&&we(a,t)}function we(a,t){return we=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},we(a,t)}function G(a,t,i){return t=Ie(t),t in a?Object.defineProperty(a,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[t]=i,a}function Ie(a){var t=pt(a,"string");return ue(t)=="symbol"?t:t+""}function pt(a,t){if(ue(a)!="object"||!a)return a;var i=a[Symbol.toPrimitive];if(i!==void 0){var r=i.call(a,t);if(ue(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}var W=function(a){function t(){var i;ct(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return i=dt(this,t,[].concat(n)),G(i,"state",{isAnimationFinished:!0}),G(i,"id",Xe("recharts-area-")),G(i,"handleAnimationEnd",function(){var l=i.props.onAnimationEnd;i.setState({isAnimationFinished:!0}),ve(l)&&l()}),G(i,"handleAnimationStart",function(){var l=i.props.onAnimationStart;i.setState({isAnimationFinished:!1}),ve(l)&&l()}),i}return ht(t,a),ut(t,[{key:"renderDots",value:function(r,n,o){var l=this.props.isAnimationActive,d=this.state.isAnimationFinished;if(l&&!d)return null;var f=this.props,u=f.dot,g=f.points,x=f.dataKey,j=ne(this.props,!1),b=ne(u,!0),E=g.map(function(w,N){var y=Y(Y(Y({key:"dot-".concat(N),r:3},j),b),{},{index:N,cx:w.x,cy:w.y,dataKey:x,value:w.value,payload:w.payload,points:g});return t.renderDotItem(u,y)}),D={clipPath:r?"url(#clipPath-".concat(n?"":"dots-").concat(o,")"):null};return S.createElement(me,ie({className:"recharts-area-dots"},D),E)}},{key:"renderHorizontalRect",value:function(r){var n=this.props,o=n.baseLine,l=n.points,d=n.strokeWidth,f=l[0].x,u=l[l.length-1].x,g=r*Math.abs(f-u),x=he(l.map(function(j){return j.y||0}));return le(o)&&typeof o=="number"?x=Math.max(o,x):o&&Array.isArray(o)&&o.length&&(x=Math.max(he(o.map(function(j){return j.y||0})),x)),le(x)?S.createElement("rect",{x:f<u?f:f-g,y:0,width:g,height:Math.floor(x+(d?parseInt("".concat(d),10):1))}):null}},{key:"renderVerticalRect",value:function(r){var n=this.props,o=n.baseLine,l=n.points,d=n.strokeWidth,f=l[0].y,u=l[l.length-1].y,g=r*Math.abs(f-u),x=he(l.map(function(j){return j.x||0}));return le(o)&&typeof o=="number"?x=Math.max(o,x):o&&Array.isArray(o)&&o.length&&(x=Math.max(he(o.map(function(j){return j.x||0})),x)),le(x)?S.createElement("rect",{x:0,y:f<u?f:f-g,width:x+(d?parseInt("".concat(d),10):1),height:Math.floor(g)}):null}},{key:"renderClipRect",value:function(r){var n=this.props.layout;return n==="vertical"?this.renderVerticalRect(r):this.renderHorizontalRect(r)}},{key:"renderAreaStatically",value:function(r,n,o,l){var d=this.props,f=d.layout,u=d.type,g=d.stroke,x=d.connectNulls,j=d.isRange;d.ref;var b=Me(d,st);return S.createElement(me,{clipPath:o?"url(#clipPath-".concat(l,")"):null},S.createElement(ge,ie({},ne(b,!0),{points:r,connectNulls:x,type:u,baseLine:n,layout:f,stroke:"none",className:"recharts-area-area"})),g!=="none"&&S.createElement(ge,ie({},ne(this.props,!1),{className:"recharts-area-curve",layout:f,type:u,connectNulls:x,fill:"none",points:r})),g!=="none"&&j&&S.createElement(ge,ie({},ne(this.props,!1),{className:"recharts-area-curve",layout:f,type:u,connectNulls:x,fill:"none",points:n})))}},{key:"renderAreaWithAnimation",value:function(r,n){var o=this,l=this.props,d=l.points,f=l.baseLine,u=l.isAnimationActive,g=l.animationBegin,x=l.animationDuration,j=l.animationEasing,b=l.animationId,E=this.state,D=E.prevPoints,w=E.prevBaseLine;return S.createElement(ze,{begin:g,duration:x,isActive:u,easing:j,from:{t:0},to:{t:1},key:"area-".concat(b),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(N){var y=N.t;if(D){var O=D.length/d.length,k=d.map(function(v,$){var V=Math.floor($*O);if(D[V]){var C=D[V],M=se(C.x,v.x),B=se(C.y,v.y);return Y(Y({},v),{},{x:M(y),y:B(y)})}return v}),A;if(le(f)&&typeof f=="number"){var m=se(w,f);A=m(y)}else if(De(f)||We(f)){var _=se(w,0);A=_(y)}else A=f.map(function(v,$){var V=Math.floor($*O);if(w[V]){var C=w[V],M=se(C.x,v.x),B=se(C.y,v.y);return Y(Y({},v),{},{x:M(y),y:B(y)})}return v});return o.renderAreaStatically(k,A,r,n)}return S.createElement(me,null,S.createElement("defs",null,S.createElement("clipPath",{id:"animationClipPath-".concat(n)},o.renderClipRect(y))),S.createElement(me,{clipPath:"url(#animationClipPath-".concat(n,")")},o.renderAreaStatically(d,f,r,n)))})}},{key:"renderArea",value:function(r,n){var o=this.props,l=o.points,d=o.baseLine,f=o.isAnimationActive,u=this.state,g=u.prevPoints,x=u.prevBaseLine,j=u.totalLength;return f&&l&&l.length&&(!g&&j>0||!Pe(g,l)||!Pe(x,d))?this.renderAreaWithAnimation(r,n):this.renderAreaStatically(l,d,r,n)}},{key:"render",value:function(){var r,n=this.props,o=n.hide,l=n.dot,d=n.points,f=n.className,u=n.top,g=n.left,x=n.xAxis,j=n.yAxis,b=n.width,E=n.height,D=n.isAnimationActive,w=n.id;if(o||!d||!d.length)return null;var N=this.state.isAnimationFinished,y=d.length===1,O=Ke("recharts-area",f),k=x&&x.allowDataOverflow,A=j&&j.allowDataOverflow,m=k||A,_=De(w)?this.id:w,v=(r=ne(l,!1))!==null&&r!==void 0?r:{r:3,strokeWidth:2},$=v.r,V=$===void 0?3:$,C=v.strokeWidth,M=C===void 0?2:C,B=He(l)?l:{},T=B.clipDot,X=T===void 0?!0:T,H=V*2+M;return S.createElement(me,{className:O},k||A?S.createElement("defs",null,S.createElement("clipPath",{id:"clipPath-".concat(_)},S.createElement("rect",{x:k?g:g-b/2,y:A?u:u-E/2,width:k?b:b*2,height:A?E:E*2})),!X&&S.createElement("clipPath",{id:"clipPath-dots-".concat(_)},S.createElement("rect",{x:g-H/2,y:u-H/2,width:b+H,height:E+H}))):null,y?null:this.renderArea(m,_),(l||y)&&this.renderDots(m,X,_),(!D||N)&&Ge.renderCallByParent(this.props,d))}}],[{key:"getDerivedStateFromProps",value:function(r,n){return r.animationId!==n.prevAnimationId?{prevAnimationId:r.animationId,curPoints:r.points,curBaseLine:r.baseLine,prevPoints:n.curPoints,prevBaseLine:n.curBaseLine}:r.points!==n.curPoints||r.baseLine!==n.curBaseLine?{curPoints:r.points,curBaseLine:r.baseLine}:null}}])}(L.PureComponent);Ve=W;G(W,"displayName","Area");G(W,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Ye.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});G(W,"getBaseValue",function(a,t,i,r){var n=a.layout,o=a.baseValue,l=t.props.baseValue,d=l??o;if(le(d)&&typeof d=="number")return d;var f=n==="horizontal"?r:i,u=f.scale.domain();if(f.type==="number"){var g=Math.max(u[0],u[1]),x=Math.min(u[0],u[1]);return d==="dataMin"?x:d==="dataMax"||g<0?g:Math.max(Math.min(u[0],u[1]),0)}return d==="dataMin"?u[0]:d==="dataMax"?u[1]:u[0]});G(W,"getComposedData",function(a){var t=a.props,i=a.item,r=a.xAxis,n=a.yAxis,o=a.xAxisTicks,l=a.yAxisTicks,d=a.bandSize,f=a.dataKey,u=a.stackedData,g=a.dataStartIndex,x=a.displayedData,j=a.offset,b=t.layout,E=u&&u.length,D=Ve.getBaseValue(t,i,r,n),w=b==="horizontal",N=!1,y=x.map(function(k,A){var m;E?m=u[g+A]:(m=Ne(k,f),Array.isArray(m)?N=!0:m=[D,m]);var _=m[1]==null||E&&Ne(k,f)==null;return w?{x:Se({axis:r,ticks:o,bandSize:d,entry:k,index:A}),y:_?null:n.scale(m[1]),value:m,payload:k}:{x:_?null:r.scale(m[1]),y:Se({axis:n,ticks:l,bandSize:d,entry:k,index:A}),value:m,payload:k}}),O;return E||N?O=y.map(function(k){var A=Array.isArray(k.value)?k.value[0]:null;return w?{x:k.x,y:A!=null&&k.y!=null?n.scale(A):null}:{x:A!=null?r.scale(A):null,y:k.y}}):O=w?n.scale(D):r.scale(D),Y({points:y,baseLine:O,layout:b,isRange:N},j)});G(W,"renderDotItem",function(a,t){var i;if(S.isValidElement(a))i=S.cloneElement(a,t);else if(ve(a))i=a(t);else{var r=Ke("recharts-area-dot",typeof a!="boolean"?a.className:""),n=t.key,o=Me(t,ot);i=S.createElement(Ue,ie({},o,{key:n,className:r}))}return i});var be=qe({chartName:"AreaChart",GraphicalChild:W,axisComponents:[{axisType:"xAxis",AxisComp:U},{axisType:"yAxis",AxisComp:q}],formatAxisMap:Je});const xt=({data:a=[]})=>{var X,H,s,p,P;const{t}=Ae(),{live_data:i}=Te(),{uuid:r}=Ce(),{nodeList:n}=Re(),{publicInfo:o}=Fe(),l=(o==null?void 0:o.record_preserve_time)||0,[d,f]=L.useState("real-time"),[u,g]=L.useState(null),[x,j]=L.useState(!1),[b,E]=L.useState(null);L.useEffect(()=>{w.length>0&&f(w[0].label)},[l]);const D=[{label:t("chart.hours",{count:4}),hours:4},{label:t("chart.days",{count:1}),hours:24},{label:t("chart.days",{count:7}),hours:168},{label:t("chart.days",{count:30}),hours:720}],w=[{label:t("common.real_time")}];if(typeof l=="number"&&l>0){for(const h of D)l>=h.hours&&w.push({label:h.label,hours:h.hours});const c=D[D.length-1];l>c.hours?w.push({label:`${t("chart.hours",{count:l})}`,hours:l}):l>4&&!D.some(h=>h.hours===l)&&w.push({label:`${t("chart.hours",{count:l})}`,hours:l})}L.useEffect(()=>{const c=w.find(h=>h.label===d);if(r){if(!c||!c.hours){g(null),E(null),j(!1);return}j(!0),E(null),fetch(`/api/records/load?uuid=${r}&hours=${c.hours}`).then(h=>{if(!h.ok)throw new Error(h.statusText);return h.json()}).then(h=>{var I;const R=((I=h.data)==null?void 0:I.records)||[];R.sort((z,F)=>new Date(z.time).getTime()-new Date(F.time).getTime()),g(R),j(!1)}).catch(h=>{E(h.message||"Error"),j(!1)})}},[d,r]);const N=["#F38181","#FCE38A","#EAFFD0","#95E1D3"],y=N[0],O=N[1],k="max-w-72 min-w-72 flex flex-col w-full h-full gap-4",A={top:0,right:16,bottom:0,left:16},m=(X=i==null?void 0:i.data)==null?void 0:X.data[r??""],_=(c,h)=>h===0||h===T.length-1?D[0].label===d||d==="real-time"||d===t("common.real_time")?new Date(c).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date(c).toLocaleDateString([],{month:"2-digit",day:"2-digit"}):"",v=n==null?void 0:n.find(c=>c.uuid===r),$=c=>{const h=new Date(c);return d===t("common.real_time")||d==="real-time"?h.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):h.toLocaleString([],{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},V=c=>`${c.toFixed(2)}%`,C=(c,h)=>e.jsxs(re,{justify:"between",align:"center",className:"mb-2",children:[e.jsx("label",{className:"text-xl font-bold",children:c}),e.jsx("label",{className:"text-sm text-muted-foreground",children:h})]}),M=60,B=M*60,T=d===t("common.real_time")||d==="real-time"?a:d===D[0].label?je(u??[],M,B*4,M*2):(()=>{var I,z;const c=((I=D.find(F=>F.label===d))==null?void 0:I.hours)||((z=w.find(F=>F.label===d))==null?void 0:z.hours)||24,h=c>120?B:M*15,R=h*2;return je(u??[],h,B*c,R)})();return e.jsxs(re,{direction:"column",align:"center",gap:"4",className:"w-full",children:[e.jsx("div",{children:e.jsx(ke,{value:d,onValueChange:f,children:w.map(c=>e.jsx(xe,{value:c.label,className:"capitalize",children:c.label==="real-time"?t("common.real_time"):c.label},c.label))})}),x&&e.jsx("div",{style:{textAlign:"center",width:"100%"},children:e.jsx($e,{})}),b&&e.jsx("div",{style:{color:"red",textAlign:"center",width:"100%"},children:b}),e.jsxs("div",{className:"gap-2 grid w-full justify-items-center mx-auto max-w-[900px]",style:{gridTemplateColumns:"repeat(auto-fit, minmax(288px, 1fr))"},children:[e.jsxs(J,{className:k,children:[C("CPU",(H=m==null?void 0:m.cpu)!=null&&H.usage?`${m.cpu.usage.toFixed(2)}%`:"-"),e.jsx(Z,{config:{cpu:{label:"CPU",color:y}},children:e.jsxs(be,{data:T,accessibilityLayer:!0,margin:A,children:[e.jsx(ee,{vertical:!1}),e.jsx(U,{dataKey:"time",tickLine:!1,tickFormatter:_,interval:0}),e.jsx(q,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(c,h)=>h!==0?`${c}%`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(te,{cursor:!1,formatter:V,content:e.jsx(ae,{labelFormatter:$,indicator:"dot"})}),e.jsx(W,{dataKey:"cpu",animationDuration:0,stroke:y,fill:y,opacity:.8,dot:!1})]})})]}),e.jsxs(J,{className:k,children:[C("Ram",e.jsxs(re,{gap:"0",direction:"column",align:"end",className:"text-sm",children:[e.jsx("label",{children:(s=m==null?void 0:m.ram)!=null&&s.used?`${K(m.ram.used)} / ${K((v==null?void 0:v.mem_total)||0)}`:"-"}),e.jsx("label",{children:(p=m==null?void 0:m.swap)!=null&&p.used?`${K(m.swap.used)} / ${K((v==null?void 0:v.swap_total)||0)}`:"-"})]})),e.jsx(Z,{config:{ram:{label:"Ram",color:y},swap:{label:"Swap",color:O}},children:e.jsxs(be,{data:T.map(c=>({time:c.time,ram:(c.ram??0)/((v==null?void 0:v.mem_total)??1)*100,ram_raw:c.ram,swap:(c.swap??0)/((v==null?void 0:v.swap_total)??1)*100,swap_raw:c.swap,client:c.client})),accessibilityLayer:!0,margin:A,children:[e.jsx(ee,{vertical:!1}),e.jsx(U,{dataKey:"time",tickLine:!1,tickFormatter:_,interval:0}),e.jsx(q,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(c,h)=>h!==0?`${c}%`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(te,{cursor:!1,formatter:(c,h,R)=>{const I=(R==null?void 0:R.payload)||{};let z=0;h==="ram"?z=I.ram_raw??0:h==="swap"&&(z=I.swap_raw??0);let F=0;if(typeof c=="number")F=c;else if(typeof c=="string"){const Q=parseFloat(c);F=isNaN(Q)?0:Q}else Array.isArray(c)&&(F=typeof c[0]=="number"?c[0]:parseFloat(c[0]||"0"));return`${K(z)} (${F.toFixed(0)}%)`},content:e.jsx(ae,{labelFormatter:$,indicator:"dot"})}),e.jsx(W,{dataKey:"ram",animationDuration:0,stroke:y,fill:y,opacity:.8,dot:!1}),e.jsx(W,{dataKey:"swap",animationDuration:0,stroke:O,fill:O,opacity:.8,dot:!1})]})})]}),e.jsxs(J,{className:k,children:[C("Disk",(P=m==null?void 0:m.disk)!=null&&P.used?`${K(m.disk.used)} / ${K((v==null?void 0:v.disk_total)||0)}`:"-"),e.jsx(Z,{config:{disk:{label:"Disk",color:y}},children:e.jsxs(be,{data:T,accessibilityLayer:!0,margin:A,children:[e.jsx(ee,{vertical:!1}),e.jsx(U,{dataKey:"time",tickLine:!1,tickFormatter:_,interval:0}),e.jsx(q,{tickLine:!1,axisLine:!1,domain:[0,(v==null?void 0:v.disk_total)||100],tickFormatter:(c,h)=>h!==0?`${K(c)}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(te,{cursor:!1,formatter:K,content:e.jsx(ae,{labelFormatter:$,indicator:"dot"})}),e.jsx(W,{dataKey:"disk",animationDuration:0,stroke:y,fill:y,opacity:.8,dot:!1})]})})]}),e.jsxs(J,{className:k,children:[C(t("nodeCard.networkSpeed"),e.jsxs(re,{gap:"0",align:"end",direction:"column",className:"text-sm",children:[e.jsxs("span",{children:["↑ ",K((m==null?void 0:m.network.up)||0),"/s"]}),e.jsxs("span",{children:["↓ ",K((m==null?void 0:m.network.down)||0),"/s"]})]})),e.jsx(Z,{config:{net_in:{label:t("chart.network_down"),color:y},net_out:{label:t("chart.network_up"),color:N[3]}},children:e.jsxs(pe,{data:T,accessibilityLayer:!0,margin:A,children:[e.jsx(ee,{vertical:!1}),e.jsx(U,{dataKey:"time",tickLine:!1,tickFormatter:_,interval:0}),e.jsx(q,{tickLine:!1,axisLine:!1,tickFormatter:(c,h)=>h!==0?`${K(c)}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(te,{cursor:!1,formatter:K,content:e.jsx(ae,{labelFormatter:$,indicator:"dot"})}),e.jsx(ce,{dataKey:"net_in",animationDuration:0,stroke:y,fill:y,opacity:.8,dot:!1}),e.jsx(ce,{dataKey:"net_out",animationDuration:0,stroke:N[3],fill:N[3],opacity:.8,dot:!1})]})})]}),e.jsxs(J,{className:k,children:[C(t("chart.connections"),e.jsxs(re,{gap:"0",align:"end",direction:"column",className:"text-sm",children:[e.jsxs("span",{children:["TCP: ",m==null?void 0:m.connections.tcp]}),e.jsxs("span",{children:["UDP: ",m==null?void 0:m.connections.udp]})]})),e.jsx(Z,{config:{connections:{label:"TCP",color:y},connections_udp:{label:"UDP",color:N[3]}},children:e.jsxs(pe,{data:T,accessibilityLayer:!0,margin:A,children:[e.jsx(ee,{vertical:!1}),e.jsx(U,{dataKey:"time",tickLine:!1,tickFormatter:_,interval:0}),e.jsx(q,{tickLine:!1,axisLine:!1,tickFormatter:(c,h)=>h!==0?`${c}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(te,{cursor:!1,content:e.jsx(ae,{labelFormatter:$,indicator:"dot"})}),e.jsx(ce,{dataKey:"connections",animationDuration:0,stroke:y,fill:y,opacity:.8,dot:!1}),e.jsx(ce,{dataKey:"connections_udp",animationDuration:0,stroke:N[3],fill:N[3],opacity:.8,dot:!1})]})})]}),e.jsxs(J,{className:k,children:[C(t("chart.process"),m==null?void 0:m.process),e.jsx(Z,{config:{process:{label:t("chart.process"),color:y}},children:e.jsxs(pe,{data:T,accessibilityLayer:!0,margin:A,children:[e.jsx(ee,{vertical:!1}),e.jsx(U,{dataKey:"time",tickLine:!1,tickFormatter:_,interval:0}),e.jsx(q,{tickLine:!1,axisLine:!1,domain:[0,100],tickFormatter:(c,h)=>h!==0?`${c}`:"",orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(te,{cursor:!1,content:e.jsx(ae,{labelFormatter:$,indicator:"dot"})}),e.jsx(ce,{dataKey:"process",animationDuration:0,stroke:y,fill:y,opacity:.8,dot:!1})]})})]})]})]})},oe=["#F38181","#347433","#898AC4","#03A6A1","#7AD6F0","#B388FF","#FF8A65","#FFD600"],yt=({uuid:a})=>{var T,X,H;const{t}=Ae(),{publicInfo:i}=Fe(),r=(i==null?void 0:i.ping_record_preserve_time)||0,n=[{label:t("chart.hours",{count:1}),hours:1},{label:t("chart.hours",{count:6}),hours:6},{label:t("chart.hours",{count:12}),hours:12},{label:t("chart.days",{count:1}),hours:24}],o=[];if(typeof r=="number"&&r>0){for(const p of n)r>=p.hours&&o.push({label:p.label,hours:p.hours});const s=n[n.length-1];r>s.hours?o.push({label:`${t("chart.hours",{count:r})}`,hours:r}):r>1&&!n.some(p=>p.hours===r)&&o.push({label:`${t("chart.hours",{count:r})}`,hours:r})}const l=((T=o.find(s=>s.hours===1))==null?void 0:T.label)||((X=o[0])==null?void 0:X.label)||"",[d,f]=L.useState(l),[u,g]=L.useState(((H=o.find(s=>s.label===l))==null?void 0:H.hours)||1),[x,j]=L.useState(null),[b,E]=L.useState([]),[D,w]=L.useState(!1),[N,y]=L.useState(null),[O,k]=L.useState(!1);L.useEffect(()=>{const s=o.find(p=>p.label===d);s&&s.hours!==void 0&&g(s.hours)},[d,o]),L.useEffect(()=>{if(a){if(!u){j(null),y(null),w(!1);return}w(!0),y(null),fetch(`/api/records/ping?uuid=${a}&hours=${u}`).then(s=>{if(!s.ok)throw new Error(s.statusText);return s.json()}).then(s=>{var P,c;const p=((P=s.data)==null?void 0:P.records)||[];p.sort((h,R)=>new Date(h.time).getTime()-new Date(R.time).getTime()),j(p),E(((c=s.data)==null?void 0:c.tasks)||[]),w(!1)}).catch(s=>{y(s.message||"Error"),w(!1)})}},[u,a]);const A=L.useMemo(()=>{var R,I,z;const s=x||[];if(!s.length)return[];const p={},P=[];for(const F of s){const Q=new Date(F.time).getTime();let fe=null;for(const Le of P)if(Math.abs(Le-Q)<=1500){fe=Le;break}const de=fe!==null?fe:Q;p[de]||(p[de]={time:new Date(de).toISOString()},fe===null&&P.push(de)),p[de][F.task_id]=F.value}let c=Object.values(p).sort((F,Q)=>new Date(F.time).getTime()-new Date(Q.time).getTime());return je(c,((R=b[0])==null?void 0:R.interval)||60,u*60*60,(I=b[0])!=null&&I.interval?((z=b[0])==null?void 0:z.interval)*1.2:60*1.2)},[x,O,b,u]),m=L.useMemo(()=>{let s=A;if(O&&b.length>0){const p=b.map(P=>String(P.id));s=Qe(A,p)}return s},[x,O,b,u]),_=(s,p)=>m.length&&(p===0||p===m.length-1)?u<24?new Date(s).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date(s).toLocaleDateString([],{month:"2-digit",day:"2-digit"}):"",v=s=>{const p=new Date(s);return u<24?p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}):p.toLocaleString([],{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},$=L.useMemo(()=>{const s={};return b.forEach((p,P)=>{s[p.id]={label:p.name,color:oe[P%oe.length]}}),s},[b]),V=L.useMemo(()=>{if(!x||!b.length)return[];const s=new Map;for(let p=x.length-1;p>=0;p--){const P=x[p];s.has(P.task_id)||s.set(P.task_id,P)}return b.map((p,P)=>{var c,h;return{...p,value:((c=s.get(p.id))==null?void 0:c.value)??null,time:((h=s.get(p.id))==null?void 0:h.time)??null,color:oe[P%oe.length]}})},[x,b]),[C,M]=L.useState({}),B=L.useCallback(s=>{const p=s.dataKey;M(P=>({...P,[p]:!P[p]}))},[]);return e.jsxs(re,{direction:"column",align:"center",gap:"4",className:"w-full",children:[e.jsx("div",{children:e.jsx(ke,{value:d,onValueChange:s=>{f(s);const p=o.find(P=>P.label===s);p&&p.hours!==void 0&&g(p.hours)},children:o.map(s=>e.jsx(xe,{value:s.label,className:"capitalize",children:s.label},s.label))})}),D&&e.jsx("div",{style:{textAlign:"center",width:"100%"},children:e.jsx($e,{})}),N&&e.jsx("div",{style:{color:"red",textAlign:"center",width:"100%"},children:N}),V.length>0?e.jsxs(J,{className:"w-full max-w-[900px] mb-2",children:[e.jsx(Ze,{className:"absolute top-0 right-0 m-2",children:e.jsx("label",{children:t("chart.loss_tips")})}),e.jsx("div",{className:"grid gap-2 mb-2 w-full",style:{gridTemplateColumns:"repeat(auto-fit, minmax(240px,1fr))"},children:V.map(s=>e.jsxs("div",{className:"flex flex-row items-center rounded",children:[e.jsx("div",{className:"w-1 h-6 rounded-xs ",style:{backgroundColor:s.color}}),e.jsxs("div",{className:"flex items-start justify-center ml-1 flex-col",children:[e.jsx("label",{className:"font-bold text-md -mb-1",children:s.name}),e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:s.value!==null?`${s.value} ms`:"-"}),e.jsx("span",{children:m&&m.length>0?`${et(A,s.id)}%${t("chart.lossRate")}`:"-"})]})]})]},s.id))})]}):e.jsx("div",{className:"w-full max-w-[900px] text-center text-muted-foreground mb-2",children:"暂无数据"}),e.jsxs(J,{className:"w-full max-w-[900px]",children:[m.length===0?e.jsx("div",{className:"w-full h-40 flex items-center justify-center text-muted-foreground",children:"暂无数据"}):e.jsx(Z,{config:$,children:e.jsxs(pe,{data:m,accessibilityLayer:!0,margin:{top:0,right:16,bottom:0,left:16},children:[e.jsx(ee,{vertical:!1}),e.jsx(U,{dataKey:"time",tickLine:!1,tickFormatter:_,interval:0}),e.jsx(q,{tickLine:!1,axisLine:!1,unit:"ms",allowDecimals:!1,orientation:"left",type:"number",tick:{dx:-10},mirror:!0}),e.jsx(te,{cursor:!1,formatter:s=>`${s} ms`,content:e.jsx(ae,{labelFormatter:v,indicator:"dot"})}),e.jsx(tt,{onClick:B}),b.map((s,p)=>e.jsx(ce,{dataKey:String(s.id),name:s.name,stroke:oe[p%oe.length],dot:!1,isAnimationActive:!1,strokeWidth:2,connectNulls:!1,type:O?"basis":"linear",hide:!!C[s.id]},s.id))]})}),e.jsxs("div",{className:"flex items-center gap-2",style:{display:D?"none":"flex"},children:[e.jsx(it,{id:"cut-peak",checked:O,onCheckedChange:k}),e.jsx("label",{htmlFor:"cut-peak",className:"text-sm font-medium",children:t("chart.cutPeak")})]})]})]})};function zt(){const{t:a}=Ae(),{onRefresh:t}=Te(),{uuid:i}=Ce(),[r,n]=L.useState([]),{nodeList:o}=Re(),[l,d]=L.useState("load"),f=o==null?void 0:o.find(u=>u.uuid===i);return L.useEffect(()=>{fetch(`/api/recent/${i}`).then(u=>u.json()).then(u=>n(u.data.slice(-300))).catch(u=>console.error("Failed to fetch recent data:",u))},[i]),L.useEffect(()=>t(g=>{if(!i)return;const x=g.data.data[i];x&&n(j=>{const b=x;return j.some(w=>w.updated_at===b.updated_at)?j:[...j,b].slice(-300)})}),[t,i]),e.jsxs(re,{className:"items-center",direction:"column",gap:"2",children:[e.jsxs("div",{className:"flex flex-col gap-1 md:p-4 p-3 border-0 rounded-md",children:[e.jsxs("h1",{className:"flex items-center flex-wrap",children:[e.jsx(at,{flag:(f==null?void 0:f.region)??""}),e.jsx(Ee,{size:"3",weight:"bold",wrap:"nowrap",children:(f==null?void 0:f.name)??i}),e.jsx(Ee,{size:"1",style:{marginLeft:"8px"},className:"text-accent-6",wrap:"nowrap",children:f==null?void 0:f.uuid})]}),e.jsx(nt,{align:"center",uuid:i??""})]}),e.jsxs(ke,{radius:"full",value:l,onValueChange:u=>d(u),children:[e.jsx(xe,{value:"load",children:a("nodeCard.load")}),e.jsx(xe,{value:"ping",children:a("nodeCard.ping")})]}),l==="load"?e.jsx(xt,{data:rt(i??"",r)}):e.jsx(yt,{uuid:i??""}),e.jsx("div",{className:"grid w-full items-center justify-center mx-auto h-full gap-4 p-1 md:grid-cols-[repeat(auto-fit,minmax(620px,1fr))] grid-cols-[repeat(auto-fit,minmax(320px,1fr))]"})]})}export{zt as default};
