import{R as c,j as t,a as x}from"./entry-index-Cq13IMyc.js";import{u as h,a as l}from"./chunk-api-BRyb5HMf.js";import{S as g,e as b,f as j,d as N}from"./chunk-SettingCard-CsyIFvca.js";import{t as d}from"./chunk-index-CSMgxAiP.js";import{S}from"./chunk-SettingCardMultiInput-0fXBZcbB.js";import{a as y}from"./chunk-Node-BXTfQ3ZC.js";import{u as w,p as C}from"./chunk-useTranslation-DT6f2-nl.js";import{p as I}from"./chunk-code-H2qyMSjH.js";import{o as T}from"./chunk-button-BTrNb_zO.js";import{p as u}from"./chunk-flex-D_qeScnl.js";import{u as P}from"./chunk-text-field-BPsisRj1.js";import"./chunk-react-vendor-Csw2ODfV.js";import"./chunk-text-area-76rX6ii9.js";import"./chunk-dropdown-menu-C_QY9m_V.js";import"./chunk-icons-Czmt910x.js";import"./chunk-require-react-element-DaU34sMa.js";import"./chunk-index-FhuETDEf.js";import"./chunk-index-SkULk3VY.js";import"./chunk-icon-button-8RHoNX6f.js";import"./chunk-switch-CttJqP-B.js";import"./chunk-index-CMdh1AKP.js";import"./chunk-proxy-BKiT5fFT.js";import"./chunk-chevron-down-BtBCajUJ.js";import"./chunk-createLucideIcon-SgBSd_zz.js";import"./chunk-index-BlzzkOYo.js";import"./chunk-box-BWWdO3eg.js";import"./chunk-use-mobile-BDllwLRx.js";import"./chunk-dialog-ChtOFG_l.js";import"./chunk-badge-C4fUOBFU.js";import"./chunk-utils-bRKmu4jq.js";import"./chunk-throttle-CmHaeH0s.js";import"./chunk-card--UUq0CNs.js";import"./chunk-internal-BM6wX41l.js";function le(){const{t:e}=w(),{settings:i,loading:n,error:o}=h(),[m,f]=c.useState(null),[v,p]=c.useState(null);return c.useEffect(()=>{const r=parseInt(i.ping_record_preserve_time||"30",10),s=parseInt(i.record_preserve_time||"30",10);if(isNaN(r)||isNaN(s)){p("0");return}else p(_(r,s))},[i.ping_record_preserve_time,i.record_preserve_time]),n?t.jsx(x,{text:"creeper?"}):o?t.jsx(C,{color:"red",children:o}):t.jsxs(t.Fragment,{children:[t.jsx("label",{className:"text-xl font-bold",children:e("settings.geoip.title")}),t.jsx(g,{title:e("settings.geoip.enable_title"),description:e("settings.geoip.enable_description"),defaultChecked:i.geo_ip_enabled,onChange:async r=>{await l({geo_ip_enabled:r},e)}}),t.jsx(b,{title:e("settings.geoip.provider_title"),description:e("settings.geoip.provider_description"),defaultValue:i.geo_ip_provider,options:[{value:"empty",label:e("common.none")},{value:"mmdb",label:"MaxMind"},{value:"ip-api",label:"ip-api.com"},{value:"geojs",label:"geojs.io"},{value:"ipinfo",label:"ipinfo.io"}],OnSave:async r=>{await l({geo_ip_provider:r},e)}}),t.jsx(j,{title:e("settings.geoip.update_title","更新 GeoIP 数据库"),onClick:async()=>{const s=await(await fetch("/api/admin/update/mmdb",{method:"POST"})).json();s.status==="success"?d.success(e("settings.geoip.update_success","GeoIP 数据库更新成功")):d.error(s.message||e("settings.geoip.update_error","更新 GeoIP 数据库失败"))},children:e("common.update","更新")}),t.jsx(N,{title:e("settings.geoip.test_title"),description:e("settings.geoip.test_description"),children:t.jsxs(u,{className:"w-full gap-2",direction:"column",children:[t.jsx(P,{placeholder:"1.1.1.1 or 2606:4700:4700::1111"}),t.jsx("div",{children:t.jsx(T,{variant:"solid",onClick:async()=>{const r=document.querySelector("input[placeholder]").value,a=await(await fetch(`/api/admin/test/geoip?ip=${r}`)).json();f(JSON.stringify(a.data,null,2)||"无结果")},children:e("settings.geoip.test_button","测试")})})," ",t.jsx(u,{className:"w-full",children:m&&t.jsx(I,{className:"w-full whitespace-pre-wrap text-sm p-3 rounded-md overflow-auto max-h-96",style:{display:"block"},children:m})})]})}),t.jsx("label",{className:"text-xl font-bold",children:e("settings.record.title")}),t.jsx(g,{title:e("settings.record.enabled"),description:e("settings.record.enabled_description"),defaultChecked:i.record_enabled,onChange:async r=>{await l({record_enabled:r},e)}}),t.jsx(S,{defaultOpen:!0,title:e("settings.record.record_preserve_time"),description:e("settings.record.record_preserve_time_description"),items:[{tag:"record_preserve_time",label:e("settings.record.record_preserve_time_label"),type:"short",placeholder:"30",defaultValue:i.record_preserve_time||"30",number:!0},{tag:"ping_record_preserve_time",label:e("settings.record.ping_record_preserve_time"),type:"short",placeholder:"30",defaultValue:i.ping_record_preserve_time||"30",number:!0}],onSave:async r=>{const s=parseInt(r.record_preserve_time,10),a=parseInt(r.ping_record_preserve_time,10);if(isNaN(s)||isNaN(a)){d.error(e("settings.record.invalid_preserve_time"));return}await l({record_preserve_time:s,ping_record_preserve_time:a},e)},onChange:r=>{const s=parseInt(r.record_preserve_time,10),a=parseInt(r.ping_record_preserve_time,10);if(isNaN(s)||isNaN(a)){p("0");return}p(_(a,s))},children:t.jsx("label",{className:"text-sm text-muted-foreground",children:e("settings.record.expected_usage",{space:v})})})]})}function _(e,i){let n=0,o=0;return n=e*3600,i<=4?o=i*30720:(o=4*30720,o+=(i-4)*2048),y(n+o)}export{le as default};
