import{r as c,j as e,a as ce}from"./entry-index-Cq13IMyc.js";import{t as p}from"./chunk-index-CSMgxAiP.js";import{u as de}from"./chunk-api-BRyb5HMf.js";import{u as he,p as o}from"./chunk-useTranslation-DT6f2-nl.js";import{c as U}from"./chunk-createLucideIcon-SgBSd_zz.js";import{p as h}from"./chunk-box-BWWdO3eg.js";import{p as l}from"./chunk-flex-D_qeScnl.js";import{o as u}from"./chunk-button-BTrNb_zO.js";import{o as me}from"./chunk-grid-CDjHE4uH.js";import{o as J}from"./chunk-card--UUq0CNs.js";import{e as pe}from"./chunk-badge-C4fUOBFU.js";import{o as ue}from"./chunk-icon-button-8RHoNX6f.js";import{s as T,p as $,g as C,m as X,D as O}from"./chunk-dialog-ChtOFG_l.js";import"./chunk-react-vendor-Csw2ODfV.js";import"./chunk-require-react-element-DaU34sMa.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],L=U("image",fe);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],V=U("settings",ge);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],B=U("upload",xe),Oe=()=>{const{t}=he(),[y,N]=c.useState([]),[G,K]=c.useState(!0),[Q,w]=c.useState(!1),[_,g]=c.useState(0),[P,v]=c.useState(null),[M,W]=c.useState(null),[A,Y]=c.useState(null),[Z,z]=c.useState(!1),[a,F]=c.useState(null),[ee,x]=c.useState(!1),[se,b]=c.useState(!1),[j,H]=c.useState(null),I=c.useRef(null),{settings:k,loading:D,refetch:R}=de(),f=k==null?void 0:k.theme,te=G||D||!f,S=async()=>{try{const s=await fetch("/api/admin/theme/list");if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=(await s.json()).data||[];n.some(i=>i.short==="default")||n.unshift({id:"default",name:t("theme.default_theme"),short:"default",description:t("theme.default_description"),author:"Akizon77",version:"1.0.0",preview:"/assets/edit_117847723_p0.png",active:f==="default",createdAt:new Date().toISOString()});const d=n.map(i=>({...i,active:i.short===f}));N(d)}catch(s){Y(s instanceof Error?s.message:"Failed to fetch themes")}finally{K(!1)}},q=async s=>{if(!s.name.endsWith(".zip")){p.error(t("theme.invalid_file_type"));return}w(!0),g(0);const r=new FormData;return r.append("file",s),new Promise((n,m)=>{const d=new XMLHttpRequest;v(d),d.upload.addEventListener("progress",i=>{if(i.lengthComputable){const le=i.loaded/i.total*100;g(Math.round(le))}}),d.addEventListener("load",async()=>{if(d.status>=200&&d.status<300)try{JSON.parse(d.responseText),p.success(t("theme.upload_success")),z(!1),g(0),await S(),n()}catch(i){p.error(t("theme.upload_failed")+": Parse error"),m(i)}else try{const i=JSON.parse(d.responseText);throw new Error(i.message||"Upload failed")}catch(i){p.error(t("theme.upload_failed")+": "+(i instanceof Error?i.message:"Unknown error")),m(i)}w(!1),v(null)}),d.addEventListener("error",()=>{p.error(t("theme.upload_failed")+": Network error"),w(!1),g(0),v(null),m(new Error("Network error"))}),d.addEventListener("abort",()=>{p.error(t("theme.upload_failed")+": Upload cancelled"),w(!1),g(0),v(null),m(new Error("Upload cancelled"))}),d.open("PUT","/api/admin/theme/upload"),d.send(r)})},ae=()=>{P&&P.abort()},E=async s=>{try{W(s);const r=await fetch(`/api/admin/theme/set?theme=${s}`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);await R(),N(n=>n.map(m=>({...m,active:m.short===s}))),p.success(t("theme.set_success"))}catch(r){p.error(t("theme.set_failed")+": "+(r instanceof Error?r.message:"Unknown error"))}finally{W(null)}},re=async s=>{try{s===f&&(await E("default"),await R());const r=await fetch("/api/admin/theme/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({short:s})});if(!r.ok){const n=await r.json();throw new Error(n.message||"Delete failed")}await S(),b(!1),x(!1),p.success(t("theme.delete_success"))}catch(r){p.error(t("theme.delete_failed")+": "+(r instanceof Error?r.message:"Unknown error"))}},ne=s=>{s.preventDefault();const n=Array.from(s.dataTransfer.files).find(m=>m.name.endsWith(".zip"));n&&q(n)},oe=s=>{s.preventDefault()},ie=s=>{var n;const r=(n=s.target.files)==null?void 0:n[0];r&&q(r)};return c.useEffect(()=>{S()},[f]),c.useEffect(()=>{!D&&y.length>0&&N(s=>s.map(r=>({...r,active:r.short===f})))},[f,D,y.length]),te?e.jsx(ce,{}):A?e.jsx(o,{color:"red",children:A}):e.jsxs(h,{className:"p-6 space-y-6",children:[e.jsxs(l,{justify:"between",align:"center",children:[e.jsx(o,{size:"6",weight:"bold",children:t("theme.title")}),e.jsxs(u,{onClick:()=>z(!0),className:"gap-2",children:[e.jsx(B,{size:16}),t("theme.upload")]})]}),y.length===0?e.jsxs(h,{className:"text-center py-12",children:[e.jsx(L,{size:64,className:"mx-auto text-gray-400 mb-4"}),e.jsx(o,{size:"4",color:"gray",className:"mb-2",children:t("theme.no_themes")}),e.jsx(o,{size:"2",color:"gray",children:t("theme.upload_first_theme")})]}):e.jsx(me,{columns:{initial:"1",sm:"2",md:"3",lg:"4"},gap:"4",children:y.map(s=>e.jsxs(J,{className:"relative group hover:shadow-lg transition-all duration-200",children:[e.jsxs(h,{onClick:()=>{x(!0),F(s)},className:"aspect-video bg-gradient-to-br rounded-t-lg overflow-hidden relative ",children:[s.preview?e.jsx("img",{src:s.short==="default"?"/assets/edit_117847723_p0.png":`/themes/${s.short}/${s.preview}`,alt:s.name,className:"w-full h-full object-cover",onError:r=>{var n;r.currentTarget.style.display="none",(n=r.currentTarget.nextElementSibling)==null||n.classList.remove("hidden")}}):null,e.jsx(l,{align:"center",justify:"center",className:`w-full h-full ${s.preview&&s.short!=="default"?"hidden":""}`,children:e.jsx(L,{size:48,className:"text-gray-400"})}),e.jsx(h,{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex items-center justify-center",children:e.jsx(l,{gap:"2"})}),s.active&&e.jsx(pe,{color:"green",className:"absolute top-2 right-2 px-2 py-1 text-xs",children:t("theme.active")})]}),e.jsxs(l,{onClick:()=>{x(!0),F(s)},direction:"column",className:"p-4 space-y-2",children:[e.jsx(o,{weight:"bold",size:"3",children:s.name}),e.jsxs(l,{justify:"between",align:"center",children:[e.jsxs(o,{size:"1",color:"gray",children:["by ",s.author]}),e.jsxs(o,{size:"1",color:"gray",children:["v",s.version]})]})]}),e.jsx(l,{justify:"end",align:"center",children:!s.active&&e.jsx(ue,{size:"2",variant:"ghost",onClick:()=>E(s.short),disabled:M===s.short,children:M===s.short?e.jsx(h,{className:"animate-spin",children:e.jsx(V,{size:16})}):e.jsx(V,{size:16})})})]},s.id))}),e.jsx(T,{open:Z,onOpenChange:z,children:e.jsxs($,{maxWidth:"450px",children:[e.jsx(C,{children:t("theme.upload_theme")}),e.jsx(X,{children:t("theme.upload_description")}),e.jsxs(h,{className:"space-y-4 mt-4",children:[e.jsxs(l,{direction:"column",align:"center",justify:"center",className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-gray-400 transition-colors",onDrop:ne,onDragOver:oe,onClick:()=>{var s;return(s=I.current)==null?void 0:s.click()},children:[e.jsx(B,{size:48,className:"mx-auto text-gray-400 mb-4"}),e.jsx(o,{size:"3",weight:"medium",children:t("theme.drag_drop")}),e.jsx(o,{size:"2",color:"gray",className:"mt-2",children:t("theme.or_click_to_browse")}),e.jsx(o,{size:"1",color:"gray",className:"mt-2",children:t("theme.zip_files_only")})]}),e.jsx("input",{ref:I,type:"file",accept:".zip",onChange:ie,className:"hidden"})]}),Q&&e.jsx(h,{className:"flex items-center justify-center z-50",children:e.jsxs(J,{className:"p-6 text-center min-w-80 max-w-md",children:[e.jsx(o,{size:"3",className:"mt-2 mb-4",children:t("theme.uploading")}),e.jsx(h,{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 mb-3 overflow-hidden",children:e.jsx(h,{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full rounded-full transition-all duration-500 ease-out relative",style:{width:`${_}%`},children:e.jsx(h,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"})})}),e.jsx(l,{justify:"between",align:"center",className:"mb-4",children:e.jsxs(o,{size:"2",color:"gray",children:[Math.round(_),"%"]})}),e.jsx(u,{variant:"soft",color:"gray",onClick:ae,disabled:_>=100,children:t("common.cancel")})]})}),e.jsx(l,{gap:"3",mt:"4",justify:"end",children:e.jsx(O,{children:e.jsx(u,{variant:"soft",color:"gray",children:t("common.cancel")})})})]})}),e.jsx(T,{open:ee,onOpenChange:x,children:e.jsxs($,{maxWidth:"800px",children:[e.jsx(C,{children:a==null?void 0:a.name}),e.jsxs(h,{className:"space-y-4 mt-4",children:[e.jsx(h,{className:"aspect-video bg-gray-100 dark:bg-gray-800 rounded-lg overflow-hidden relative",children:a!=null&&a.preview&&a.short!=="default"?e.jsx("img",{src:`/themes/${a.short}/${a.preview}`,alt:a.name,className:"w-full h-full object-cover"}):(a==null?void 0:a.short)==="default"?e.jsx("img",{src:"/assets/edit_117847723_p0.png",alt:a.name,className:"w-full h-full object-cover"}):e.jsx(l,{align:"center",justify:"center",className:"w-full h-full",children:e.jsx(L,{size:64,className:"text-gray-400"})})}),e.jsxs(l,{direction:"column",children:[e.jsxs(l,{gap:"2",justify:"start",align:"center",children:[e.jsx(o,{size:"2",weight:"bold",color:"gray",children:t("theme.author")}),e.jsx(o,{size:"3",children:a==null?void 0:a.author})]}),e.jsxs(l,{gap:"2",justify:"start",align:"center",children:[e.jsx(o,{size:"2",weight:"bold",color:"gray",children:t("theme.version")}),e.jsx(o,{size:"3",children:a==null?void 0:a.version})]}),e.jsxs(l,{gap:"2",justify:"start",align:"center",children:[e.jsx(o,{size:"2",weight:"bold",color:"gray",children:t("theme.description")}),e.jsx(o,{size:"3",children:a==null?void 0:a.description})]})]})]}),e.jsxs(l,{gap:"3",mt:"4",justify:"end",children:[e.jsx(O,{children:e.jsx(u,{variant:"soft",color:"gray",children:t("common.close")})}),a&&!a.active&&e.jsx(u,{onClick:()=>{E(a.short),x(!1)},children:t("theme.set_active")}),a&&a.short!=="default"&&e.jsx(u,{size:"2",variant:"solid",color:"red",onClick:()=>{H(a),b(!0)},children:t("common.delete")})]})]})}),e.jsx(T,{open:se,onOpenChange:b,children:e.jsxs($,{maxWidth:"400px",children:[e.jsx(C,{children:t("theme.confirm_delete")}),e.jsx(X,{children:t("theme.delete_warning",{themeName:j==null?void 0:j.name})}),e.jsxs(l,{gap:"3",mt:"4",justify:"end",children:[e.jsx(O,{children:e.jsx(u,{variant:"soft",color:"gray",children:t("common.cancel")})}),e.jsx(u,{color:"red",onClick:async()=>{j&&(await re(j.short),b(!1),H(null))},children:t("common.delete")})]})]})})]})};export{Oe as default};
