import{r as t,j as e,L as S,o as I,O as _}from"./entry-index-Cq13IMyc.js";import{L as k,N as A}from"./chunk-LiveDataContext-BPSUpA8k.js";import{p as w}from"./chunk-flex-D_qeScnl.js";import{p as l,u as P}from"./chunk-useTranslation-DT6f2-nl.js";import{T as E,C as K}from"./chunk-ThemeSwitch-oxfBYUwN.js";import{b as $,G as M,L as q}from"./chunk-Tabler-CuHLT1Z-.js";import{A as O,u as V}from"./chunk-AccountContext-Cg6rtKP_.js";import{o as m}from"./chunk-button-BTrNb_zO.js";import{o as N}from"./chunk-icon-button-8RHoNX6f.js";import{s as B,n as G,p as R,g as U,m as W}from"./chunk-dialog-ChtOFG_l.js";import{p as Z}from"./chunk-box-BWWdO3eg.js";import{u as b}from"./chunk-text-field-BPsisRj1.js";import"./chunk-react-vendor-Csw2ODfV.js";import"./chunk-dropdown-menu-C_QY9m_V.js";import"./chunk-icons-Czmt910x.js";import"./chunk-require-react-element-DaU34sMa.js";import"./chunk-index-FhuETDEf.js";import"./chunk-index-SkULk3VY.js";import"./chunk-internal-BM6wX41l.js";const H=()=>{const i=h=>new Date(h).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Shanghai"})+" (GMT+8)",n="2025-07-19T06:43:46.160Z",[d,x]=t.useState(null);return t.useEffect(()=>{(async()=>{try{const a=await(await fetch("/api/version")).json();a.status==="success"&&x({hash:a.data.hash.slice(0,7),version:a.data.version})}catch(r){console.error("Failed to fetch version info:",r)}})()},[]),e.jsx("div",{className:"footer p-2 border-t-1 border-t-[var(--gray-7)]",children:e.jsx(w,{direction:{initial:"column",md:"row"},justify:"between",align:{initial:"center",md:"start"},gap:"4",style:{maxWidth:"1200px",margin:"0 auto"},children:e.jsxs(w,{direction:"column",gap:"2",align:{initial:"center",md:"start"},children:[e.jsx(l,{size:"2",color:"gray",children:"Powered by Komari Monitor."}),e.jsxs(l,{size:"1",color:"gray",children:["Build Time: ",i(n)]}),e.jsx(l,{size:"1",color:"gray",children:d&&`${d.version} (${d.hash})`})]})})})},J=()=>{const i=()=>{const{account:n,loading:d,error:x,refresh:h}=V(),[r]=P(),[a,T]=t.useState(""),[g,C]=t.useState(""),[f,F]=t.useState(""),[v,u]=t.useState(""),[o,y]=t.useState(!1),[z,D]=t.useState(!1),c=a.trim()!==""&&g.trim()!=="",p=async()=>{if(!c){u("Username and password are required");return}u(""),y(!0);try{const s=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:a,password:g,...f&&!(n!=null&&n["2fa_enabled"])?{"2fa_code":f}:{}})}),L=await s.json();if(s.status===200)h(),window.open("/admin","_self");else{if(L.message==="2FA code is required"){D(!0);return}u(L.message||"Login failed")}}catch(s){u("Network error"),console.error(s)}finally{y(!1)}},j=s=>{s.key==="Enter"&&!o&&c&&(s.preventDefault(),p())};return d?e.jsx(m,{disabled:!0,children:r("loading")}):x||!n?e.jsx(m,{disabled:!0,color:"red",children:"Error"}):n.logged_in?e.jsx(S,{to:"/admin",children:e.jsx(N,{children:e.jsx($,{})})}):e.jsxs(B,{children:[e.jsx(G,{children:e.jsx(m,{children:r("login.title")})}),e.jsxs(R,{maxWidth:"450px",children:[e.jsx(U,{children:r("login.title")}),e.jsx(W,{size:"2",mb:"4",children:r("login.desc")}),e.jsx(Z,{onSubmit:s=>{s.preventDefault(),c&&!o&&p()},children:e.jsxs(w,{direction:"column",gap:"3",children:[e.jsxs("label",{children:[e.jsx(l,{as:"div",size:"2",mb:"1",weight:"bold",children:r("login.username")}),e.jsx(b,{value:a,onChange:s=>T(s.target.value),onKeyDown:j,placeholder:"admin",disabled:o,autoFocus:!0})]}),e.jsxs("label",{children:[e.jsx(l,{as:"div",size:"2",mb:"1",weight:"bold",children:r("login.password")}),e.jsx(b,{value:g,onChange:s=>C(s.target.value),onKeyDown:j,type:"password",placeholder:r("login.password_placeholder"),disabled:o})]}),e.jsxs("label",{hidden:!z,children:[e.jsx(l,{as:"div",size:"2",mb:"1",weight:"bold",children:r("login.two_factor")}),e.jsx(b,{value:f,onChange:s=>F(s.target.value),onKeyDown:j,type:"text",placeholder:"000000",disabled:o})]}),v&&e.jsx(l,{as:"div",size:"2",color:"red",children:v}),e.jsx(m,{type:"submit",disabled:o||!c,style:{opacity:o||!c?.6:1},onClick:p,children:o?"Logging in...":r("login.title")}),e.jsx(m,{onClick:()=>{window.location.href="/api/oauth"},variant:"soft",disabled:o,type:"button",children:r("login.login_with_github")})]})})]})]})};return e.jsx(O,{children:e.jsx(i,{})})},Q=()=>{const{publicInfo:i}=I();return e.jsxs("nav",{className:"nav-bar flex rounded-b-lg items-center gap-3 max-h-16 justify-end min-w-full p-2",children:[e.jsxs("div",{className:"mr-auto flex",children:[e.jsx(S,{to:"/",children:e.jsx("label",{className:"md:ml-4 text-3xl font-bold ",children:i==null?void 0:i.sitename})}),e.jsxs("div",{className:"hidden flex-row items-end md:flex",children:[e.jsx("div",{style:{color:"var(--accent-3)"},className:"border-solid border-r-2 mr-1 mb-1 w-2 h-2/3"}),e.jsx("label",{className:"text-base font-bold",style:{color:"var(--accent-4)"},children:"Komari Monitor"})]})]}),e.jsx(N,{variant:"soft",onClick:()=>{window.open("https://github.com/komari-monitor","_blank")},children:e.jsx(M,{})}),e.jsx(E,{}),e.jsx(K,{}),e.jsx(q,{}),e.jsx(J,{})]})},pe=()=>{const i=()=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"layout flex flex-col w-full min-h-screen bg-accent-1",children:[e.jsx(Q,{}),e.jsx("main",{className:"main-content m-1 h-full",children:e.jsx(_,{})}),e.jsx(H,{})]})});return e.jsx(k,{children:e.jsx(A,{children:e.jsx(i,{})})})};export{pe as default};
