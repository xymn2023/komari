import{R as s,j as a,a as u}from"./entry-index-Cq13IMyc.js";import{u as h,a as n}from"./chunk-api-BRyb5HMf.js";import{S as l,e as b,f as x,b as y}from"./chunk-SettingCard-CsyIFvca.js";import{S as d}from"./chunk-SettingCardMultiInput-0fXBZcbB.js";import{t as r}from"./chunk-index-CSMgxAiP.js";import{u as S,p as j}from"./chunk-useTranslation-DT6f2-nl.js";import"./chunk-react-vendor-Csw2ODfV.js";import"./chunk-text-area-76rX6ii9.js";import"./chunk-flex-D_qeScnl.js";import"./chunk-button-BTrNb_zO.js";import"./chunk-dropdown-menu-C_QY9m_V.js";import"./chunk-icons-Czmt910x.js";import"./chunk-require-react-element-DaU34sMa.js";import"./chunk-index-FhuETDEf.js";import"./chunk-index-SkULk3VY.js";import"./chunk-icon-button-8RHoNX6f.js";import"./chunk-switch-CttJqP-B.js";import"./chunk-index-CMdh1AKP.js";import"./chunk-text-field-BPsisRj1.js";import"./chunk-internal-BM6wX41l.js";import"./chunk-proxy-BKiT5fFT.js";import"./chunk-chevron-down-BtBCajUJ.js";import"./chunk-createLucideIcon-SgBSd_zz.js";import"./chunk-index-BlzzkOYo.js";const Q=()=>{const{t}=S(),{settings:i,loading:_,error:m}=h(),[g,c]=s.useState(i.email_host||""),[f,p]=s.useState(i.email_port||"");return s.useEffect(()=>{c(i.email_host||""),p(i.email_port||"")},[i.email_host,i.email_port]),_?a.jsx(u,{}):m?a.jsx(j,{color:"red",children:m}):a.jsxs(a.Fragment,{children:[a.jsx("label",{className:"text-xl font-bold",children:t("settings.notification.title")}),a.jsx(l,{title:t("settings.notification.enable"),description:t("settings.notification.enable_description"),defaultChecked:i.notification_enabled,onChange:async e=>{await n({notification_enabled:e},t)}}),a.jsx(b,{title:t("settings.notification.method"),description:t("settings.notification.method_description"),defaultValue:i.notification_method,options:[{value:"none",label:t("common.none")},{value:"telegram",label:"Telegram"},{value:"email",label:t("settings.notification.email")}],OnSave:async e=>{await n({notification_method:e},t)}}),a.jsx(d,{title:t("settings.notification.telegram_title"),description:t("settings.notification.telegram_description"),items:[{tag:"telegram_endpoint",label:t("settings.notification.telegram_endpoint"),type:"short",placeholder:"https://api.telegram.org/bot",defaultValue:i.telegram_endpoint||""},{tag:"telegram_bot_token",label:t("settings.notification.telegram_bot_token"),type:"short",placeholder:"1234567890:ABCDEFGHIJKLMNOPQRSTUVWXYZ",defaultValue:i.telegram_bot_token||""},{tag:"telegram_chat_id",label:"Chat ID",type:"short",placeholder:"1234567890",defaultValue:i.telegram_chat_id||""}],onSave:async e=>{if(/^-?\d+$/.test(e.telegram_chat_id)===!1){r.error(t("settings.notification.telegram_chat_id_error","Chat ID must be a number"));return}await n({telegram_bot_token:e.telegram_bot_token,telegram_chat_id:e.telegram_chat_id,telegram_endpoint:e.telegram_endpoint},t)}}),a.jsxs(d,{title:t("settings.notification.smtp_title"),description:t("settings.notification.smtp_description"),items:[{tag:"email_host",label:t("settings.notification.smtp_host"),type:"short",placeholder:"smtp.example.com",defaultValue:i.email_host||""},{tag:"email_port",label:t("settings.notification.smtp_port"),type:"short",number:!0,placeholder:"587",defaultValue:i.email_port||""},{tag:"email_username",label:t("settings.notification.smtp_username"),type:"short",placeholder:"user@example.com",defaultValue:i.email_username||""},{tag:"email_password",label:t("settings.notification.smtp_password"),type:"short",defaultValue:i.email_password||""},{tag:"email_sender",label:t("settings.notification.smtp_sender"),type:"short",placeholder:"me@example.com",defaultValue:i.email_sender},{tag:"email_receiver",label:t("settings.notification.smtp_receiver"),type:"short",placeholder:"receiver@example.com",defaultValue:i.email_receiver||""}],onChange:e=>{c(e.email_host),p(e.email_port)},onSave:async e=>{const o=Number(e.email_port);if(isNaN(o)||o<=0){r.error("Please enter a valid port number");return}await n({email_host:e.email_host,email_port:o,email_username:e.email_username,email_password:e.email_password,email_sender:e.email_sender,email_receiver:e.email_receiver},t)},children:[a.jsx(l,{title:t("settings.notification.smtp_ssl"),bordless:!0,defaultChecked:i.email_use_ssl,onChange:async e=>{await n({email_use_ssl:e},t)}}),a.jsx("label",{className:"-mt-2 text-sm text-gray-500",children:t("settings.notification.smtp_tips",{command:`telnet ${g} ${f}`})})]}),a.jsx(x,{title:t("settings.notification.test_title"),description:t("settings.notification.test_description"),onClick:async()=>{try{const e=await fetch("/api/admin/test/sendMessage",{method:"POST"});let o;try{o=await e.json()}catch{r.error(t("common.error"));return}if(o&&o.message&&o.code!==200){r.error(o.message);return}r.success(t("common.success"))}catch(e){r.error(t("common.error")+": "+(e instanceof Error?e.message:String(e)))}},children:"GO"}),a.jsx("label",{className:"text-xl font-bold",children:t("admin.notification.expire_title")}),a.jsx(l,{defaultChecked:i.expire_notification_enabled,title:t("admin.notification.expire_enable"),description:t("admin.notification.expire_enable_description"),onChange:async e=>{await n({expire_notification_enabled:e},t)}}),a.jsx(y,{number:!0,title:t("admin.notification.expire_time"),description:t("admin.notification.expire_time_description"),defaultValue:i.expire_notification_lead_days,OnSave:async e=>{const o=Number(e);if(isNaN(o)||o<0){r.error("Please enter a valid non-negative number");return}await n({expire_notification_lead_days:o},t)}})]})};export{Q as default};
